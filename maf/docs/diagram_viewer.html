<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PM Copilot - Architecture Diagrams</title>
    <script src="https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js"></script>
    <script>
        mermaid.initialize({
            startOnLoad: true,
            theme: 'default',
            securityLevel: 'loose',
        });
    </script>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            line-height: 1.6;
            max-width: 1200px;
            margin: 0 auto;
            padding: 2rem;
            background-color: #f9f9f9;
            color: #333;
        }
        h1 { margin-bottom: 2rem; border-bottom: 2px solid #eaeaea; padding-bottom: 1rem; }
        h2 { margin-top: 3rem; color: #444; }
        .diagram-container {
            background: white;
            padding: 2rem;
            border-radius: 8px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            margin-bottom: 2rem;
            overflow-x: auto;
        }
        .mermaid { text-align: center; }
    </style>
</head>
<body>
    <h1>PM Copilot â€” Architecture Diagrams</h1>
    <p>These diagrams are rendered from the source code in <code>maf/docs/APPLICATION_FLOW.md</code> using Mermaid.js.</p>

    <!-- 1. Orchestration Comparison -->
    <h2>1. MAF Orchestration Patterns</h2>
    <div class="diagram-container">
        <div class="mermaid">
graph LR
    subgraph "Sequential"
        A1[Agent A] --> B1[Agent B] --> C1[Agent C]
    end
    subgraph "Concurrent"
        A2[Agent A]
        B2[Agent B]
        C2[Agent C]
    end
    subgraph "Group Chat"
        A3[Agent A] <--> B3[Agent B]
        B3 <--> C3[Agent C]
        C3 <--> A3
    end
    subgraph "Handoff âœ… (Our Choice)"
        T[Coordinator] --> S1[Specialist 1]
        T --> S2[Specialist 2]
        S1 --> T
        S2 --> T
    end
        </div>
    </div>

    <!-- 2. Application Architecture -->
    <h2>2. Application Architecture</h2>
    <div class="diagram-container">
        <div class="mermaid">
graph TD
    User["ðŸ‘¤ User Input<br/>(Console / Teams / DevUI)"]
    
    subgraph "app.py â€” Entry Point"
        CLI["CLI Parser<br/>--console / --server / --devui"]
        Loop["Conversation Loop<br/>run() â†’ handle_events() â†’ run(responses=)"]
    end
    
    subgraph "orchestration/handoff_workflow.py"
        HB["HandoffBuilder<br/>Wires 6 agents into star topology"]
        WF["Built Workflow<br/>.run() / .run(responses=)"]
    end
    
    subgraph "agents/ â€” 6 Agent Definitions"
        Triage["ðŸŽ¯ triage_agent<br/>(Coordinator)"]
        SP["ðŸ“‚ sharepoint_agent"]
        Meet["ðŸ“‹ meetings_agent"]
        Cal["ðŸ“… calendar_agent"]
        Doc["ðŸ“„ documents_agent"]
        Info["ðŸ’¡ project_info_agent"]
    end
    
    subgraph "tools/ â€” 12 Tool Functions"
        SPT["SharePoint Tools (4)"]
        MT["Meeting Tools (4)"]
        CT["Calendar Tools (2)"]
        DT["Document Tools (2)"]
    end
    
    subgraph "External"
        OpenAI["OpenAI API<br/>(gpt-4o)"]
        Graph["MS Graph API<br/>(mock or live)"]
    end
    
    User --> CLI --> Loop
    Loop --> WF
    HB --> WF
    WF --> Triage
    Triage --> SP & Meet & Cal & Doc & Info
    SP --> SPT
    Meet --> MT
    Cal --> CT
    Doc --> DT
    SPT & MT & CT --> Graph
    Triage & SP & Meet & Cal & Doc & Info --> OpenAI
        </div>
    </div>

    <!-- 3. Handoff Concept -->
    <h2>3. The Handoff Pattern (Conceptual)</h2>
    <div class="diagram-container">
        <div class="mermaid">
sequenceDiagram
    participant User
    participant Triage as ðŸŽ¯ Triage Agent
    participant Specialist as ðŸ“‹ Specialist Agent
    participant Tool as ðŸ”§ Tool Function
    
    User->>Triage: "Show me yesterday's meetings"
    Note over Triage: Analyses intent â†’<br/>meetings domain
    Triage->>Specialist: ðŸ”€ HANDOFF to meetings_agent
    Note over Specialist: Receives full<br/>conversation history
    Specialist->>Tool: Calls list_recent_meetings()
    Tool-->>Specialist: Returns meeting data
    Specialist->>User: Formatted meeting list
    Note over User: User replies or<br/>asks follow-up
    User->>Triage: "Now create a report from that"
    Note over Triage: New intent â†’<br/>documents domain
    Triage->>Specialist: ðŸ”€ HANDOFF to documents_agent
        </div>
    </div>

    <!-- 4. Routing Topology -->
    <h2>4. Star Topology Routing</h2>
    <div class="diagram-container">
        <div class="mermaid">
graph LR
    T["ðŸŽ¯ triage_agent"]
    SP["ðŸ“‚ sharepoint_agent"]
    M["ðŸ“‹ meetings_agent"]
    C["ðŸ“… calendar_agent"]
    D["ðŸ“„ documents_agent"]
    PI["ðŸ’¡ project_info_agent"]
    
    T -->|"handoff_to_sharepoint_agent"| SP
    T -->|"handoff_to_meetings_agent"| M
    T -->|"handoff_to_calendar_agent"| C
    T -->|"handoff_to_documents_agent"| D
    T -->|"handoff_to_project_info_agent"| PI
    
    SP -->|"handoff_to_triage_agent"| T
    M -->|"handoff_to_triage_agent"| T
    C -->|"handoff_to_triage_agent"| T
    D -->|"handoff_to_triage_agent"| T
    PI -->|"handoff_to_triage_agent"| T
        </div>
    </div>

    <!-- 5. Request Flow Sequence -->
    <h2>5. Detailed Request Flow</h2>
    <div class="diagram-container">
        <div class="mermaid">
sequenceDiagram
    participant U as ðŸ‘¤ User (console)
    participant App as app.py
    participant WF as Handoff Workflow
    participant T as ðŸŽ¯ triage_agent
    participant LLM as OpenAI GPT-4o
    participant M as ðŸ“‹ meetings_agent
    participant Tool as list_recent_meetings()
    participant Mock as MockGraphClient
    
    U->>App: "Show me yesterday's meetings"
    App->>WF: workflow.run(user_input, stream=True)
    WF->>T: Pass message to start agent
    T->>LLM: System prompt + user message
    LLM-->>T: Tool call: handoff_to_meetings_agent
    Note over WF: ðŸ”€ handoff_sent event emitted
    WF->>M: Transfer conversation to meetings_agent
    M->>LLM: System prompt + full conversation
    LLM-->>M: Tool call: list_recent_meetings("me", 1)
    M->>Tool: Execute list_recent_meetings
    Tool->>Mock: client.list_meetings("me", 1)
    Mock-->>Tool: Returns mock meeting data
    Tool-->>M: JSON meeting list
    M->>LLM: Tool result + conversation
    LLM-->>M: Formatted response to user
    Note over WF: output event + request_info event emitted
    WF-->>App: Stream of WorkflowEvents
    App->>App: handle_events() processes events
    App->>U: Displays formatted meeting list
    Note over App: Enters pending loop,<br/>waits for next user input
        </div>
    </div>

    <!-- 6. Tool Execution Flow -->
    <h2>6. Tool Execution Architecture</h2>
    <div class="diagram-container">
        <div class="mermaid">
graph LR
    LLM["OpenAI GPT-4o"] -->|"Tool call JSON"| MAF["MAF Runtime"]
    MAF -->|"Executes locally"| Fn["Python Function"]
    Fn -->|"Calls API"| Graph["MS Graph / openpyxl"]
    Graph -->|"Returns data"| Fn
    Fn -->|"Returns string"| MAF
    MAF -->|"Tool result"| LLM
        </div>
    </div>

</body>
</html>
